#!/bin/bash
#
# Sets up a unionfs directory for programs that need
# absolute paths to their data.
#

function print-help() {
    echo "usm-prefix [start|stop] [prefix]
Runs a unionfs mount on top of ~/Apps/install to accomidate
programs that need absolute paths. start activates the unionfs
mount betwen ~/Apps/install and the prefix, while stop deactivates
it.

Example:
   usm-prefix start big-program
"
    exit 1
}

COMMAND="$1"
PROGRAM_DIRECTORY="$2"

if [ "$COMMAND" = "start" ]; then
    if [ "$PROGRAM_DIRECTORY" = "" ]; then
        print-help
    fi

    POSSIBLE=( $HOME/Apps/$PROGRAM_DIRECTORY* )
    if [ ${#POSSIBLE[@]} -gt 1 ]; then
        echo "ERROR: Ambiguity in program prefix. Try being more specific."
        exit 1
    fi

    if [ ${#POSSIBLE[@]} -eq 0 ]; then
        echo "ERROR: No matches found"
        exit 1
    fi

    ACTUAL_PREFIX="${POSSIBLE[0]}"

    unionfs "$ACTUAL_PREFIX=RW" "$HOME/Apps/install"
elif [ "$COMMAND" = "stop" ]; then
    fusermount -u "$HOME/Apps/install"
else
    print-help
fi
