#!/bin/bash
#
# Sets up a unionfs directory for programs that need
# absolute paths to their data.
#

function print-help() {
    echo "usm-prefix <start|stop> <name> <version>
Runs a unionfs mount on top of ~/Apps/install to accomidate
programs that need absolute paths. start activates the unionfs
mount betwen ~/Apps/install and the prefix, while stop deactivates
it.

Example:
   usm-prefix start current big-program
"
    exit 1
}

COMMAND="$1"
PROGRAM_NAME="$2"
PROGRAM_VERSION="$3"

if [ "$COMMAND" = "start" ]; then
    if [ "$PROGRAM_NAME" = "" -o "$PROGRAM_VERSION" = "" ]; then
        print-help
    fi
    
    if [ ! -d "$HOME/Apps/$PROGRAM_NAME/$PROGRAM_VERSION" ]; then
        echo "Cannot find $PROGRAM_NAME with version $PROGRAM_VERSION"
        exit 2
    fi

    unionfs "$HOME/Apps/$PROGRAM_NAME/$PROGRAM_VERSION=RW" "$HOME/Apps/install"
elif [ "$COMMAND" = "stop" ]; then
    fusermount -u "$HOME/Apps/install"
else
    print-help
fi
